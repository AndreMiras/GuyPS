#:import find kivy.resources
#:import MapSource mapview.MapSource

<Toolbar@BoxLayout>:
    size_hint_y: None
    height: '48dp'
    padding: '4dp'
    spacing: '4dp'

    canvas:
        Color:
            rgba: .2, .2, .2, .6
        Rectangle:
            pos: self.pos
            size: self.size

<ShadedLabel@Label>:
    size: self.texture_size
    canvas.before:
        Color:
            rgba: .2, .2, .2, .6
        Rectangle:
            pos: self.pos
            size: self.size

<OfflineMapsScreen>:

    BoxLayout:
        id: layout_boxlayout
        orientation: 'vertical'
        TextInput:
            multiline: False
            on_text_validate: app.controller.download_for_offline(self.text)
        Spinner:
            text: "Choose a offline map"
            values: root.available_offline_maps()
        Button:
            text: 'Back to map'
            on_press:
                root.manager.current = 'map'
                root.manager.transition.direction = 'left'
        Button:
            text: 'Back to menu'
            on_press:
                root.manager.current = 'menu'
                root.manager.transition.direction = 'left'

<MenuScreen@Screen>:
    BoxLayout:
        orientation: 'vertical'
        Button:
            text: 'Back to map'
            on_press:
                root.manager.current = 'map'
                root.manager.transition.direction = 'left'
        ToggleButton:
            font_name: find.resource_find('static/fonts/fontawesome-4.3.0-webfont.ttf')
            text: unichr(0xf041)
            on_state:
                root.manager.current = 'map'
                root.manager.transition.direction = 'left'
                start = self.state == 'down'
                app.controller.toggle_gps_localize(start)
        Button:
            text: 'Offline maps'
            on_press:
                root.manager.current = 'offline_maps'
                root.manager.transition.direction = 'right'
        Button:
            text: 'Goto settings'
            on_press: root.manager.current = 'settings'

<SettingsScreen@Screen>:
    BoxLayout:
        orientation: 'vertical'
        Button:
            text: 'My settings button'
        Button:
            text: 'Back to map'
            on_press:
                root.manager.current = 'map'
                root.manager.transition.direction = 'left'
        Button:
            text: 'Back to menu'
            on_press:
                root.manager.current = 'menu'
                root.manager.transition.direction = 'left'

<MapViewScreen>:
    search_input_property: search_input

    CustomMapView:
        id: mapview
        # lat: 50.6394
        # lon: 3.057
        lat: 43.61
        lon: 3.88
        zoom: 8
        #size_hint: .5, .5
        #pos_hint: {"x": .25, "y": .25}

        MapMarker:

    Toolbar:
        top: root.top
        # Spinner:
        #     text: "mapnik"
        #     values: MapSource.providers.keys()
        #     on_text: mapview.map_source = self.text
        Button:
            size_hint_x: None
            width: '48dp'
            font_name: find.resource_find('static/fonts/fontawesome-4.3.0-webfont.ttf')
            text: unichr(0xf0c9)
            on_press:
                root.manager.current = 'menu'
                root.manager.transition.direction = 'right'
        TextInput:
            id: search_input
            multiline: False
            on_text_validate: mapview.search(self.text)

    Toolbar:
        id: status_bar
        Label:
            text: root.status_message

<PopupMessage>:
    size_hint: .5, .5
    auto_dismiss: True
    title: root.title
    on_touch_down:
        self.dismiss()
    Label:
        text: root.body

# RelativeLayout:
<Controller>:
    mapview_screen_property: mapview_screen

    ScreenManager:

        MapViewScreen:
            id: mapview_screen
            name: 'map'

        MenuScreen:
            id: menu_screen
            name: 'menu'

        OfflineMapsScreen:
            id: offline_maps_screen
            name: 'offline_maps'

        SettingsScreen:
            id: settings_screen
            name: 'settings'
